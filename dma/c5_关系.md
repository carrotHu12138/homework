[TOC]
# 离散数学及其应用
## 第5章 关系
### 5.1 关系及其性质
#### 5.1.1 引言
** 定义一 ** 设 $A和B$是集合，一个从 $A到B$的二元关系是 $A\times B$的子集。
换句话说，一个从 $A到B$的二元关系是有序对的集合 $R$，其中每个有序对的第一个元素取自 $A$并且第二个元素取自 $B$。我们使用记号 $aRb$表示 $(a,b)\in R$， $a\not R b$表示 $(a,b) \notin R$。当 $(a,b)$属于 $R$时称 $a与b$有关系 $R$。

#### 5.1.2 函数作为关系
关系是函数的推广，可以用关系表示集合之间更为广泛的联系。
#### 5.1.3 集合的关系

** 定义二 **集合 $A$的关系是从 $A到A$的关系。
换句话说，集合 $A$的关系是 $A\times A$的子集。

#### 5.1.4 关系的性质

** 定义三 ** 如果对每个元素 $a \in A有(a, a) \in R$，那么集合$A$上的关系 $R$叫做自反的。

** 定义四 ** 对于 $a,b \in A$，如果只要 $(a,b) \in R$就有 $(b,a)\in R$，则集合 $A$上的关系 $R$叫做对称的。如果 $a,b \in A$，仅当 $a = b时(a,b) \in R和(b,a) \in R$，则集合 $A$上的关系 $R$叫做反对称的。

** 定义五 ** 如果对于 $a,b ,c\in A,(a,b) \in R \wedge (b,c) \in R \to (a,c) \in R$，那么集合 $A$上的关系 $R$叫做传递的。

#### 5.1.5 关系的组合

** 定义六 ** 设 $R$是从集合 $A到集合B$的关系， $S$是从集合 $B到集合C$的关系。 $R和S$的合成是由有序对 $(a,c)$构成的关，其中 $a\in A,c \in C$，并且对于它们存在一个元素 $b \in B$使得 $(a,b) \in R和(b,c) \in S$。我们用 $S \circ R$表示 $R与S$的合成。

** 定义七 ** 设 $R$是集合 $A$上的关系。幂 $R^n,n = 1 ,2,3,\cdots$，递归的定义为
$$
R^1  = R
\qquad和\quad
R^{n+1} =  R^n \circ R
$$

** 定理一 ** 集合 $A$上的关系 $R$是传递的，当且仅当对 $n=1,2,3,\cdots$，有 $R^n \subseteq R$。

### 5.2 n元关系及其应用
#### 5.2.1 引言
#### 5.2.2 n元关系

** 定义一 ** 设 $A_1,A_2,\cdots,A_n$是集合。在这些集合上的 $n$元关系是 $A_1\times A_2 \times \cdots \times A_n$的子集。这些集合 $A_1,A_2,\cdots,A_n$叫做关系的域， $n$叫做它的阶。

#### 5.2.3 数据库和关系
#### 5.2.4 n元关系运算符
** 定义二 ** 设 $R是n元关系$， $C是R$中元素可能满足的一个条件。那么选择运算符 $s_c将n$元关系 $R$映射到 $R$中满足条件 $C$的所有 $n$元组构成的 $n$元关系。

** 定义三 ** 投影 $P_{i_1,i_2,\cdots,i_m}$将 $n$元组 $(a_1,a_2,\cdots,a_n)$映射到 $m$元组$(a_{i_1},a_{i_2},\cdots,a_{i_m})$，其中 $m \leq n$。

** 定义四 ** 设 $R$是 $m$元关系且 $S$是 $n$元关系，其中 $p \leq m 和 p \leq n$。连接 $J_p(R,S)$是 $m+n -p$元关系，它包含了所有的 $(m+n-p)$元组 $(a_1,a_2,\cdots,a_{m-p}, c_1,c_2,\cdots,c_p,b_1,b_2,\cdots,b_{n-p})$，其中 $m$元组 $(a_1,a_2,\cdots,a_{m-p},c_1,c_2,,\cdots,c_p)$属于 $R$且 $(c_1,c_2,\cdots,c_p,b_1,b_2,\cdots,b_{n-p})$属于 $S$。

#### 5.2.5 SQL
### 5.3 关系的表示
#### 5.3.1 引言
#### 5.3.2 用矩阵表示关系
可以用 $ 0\mbox{-}1 $矩阵来表示一个有穷集合之间的关系。假设 $R$是从 $A = {a_1,a_2,\cdots,a_m}到B = {b_1,b_2,\cdots,b_n}$的关系。(这里集合$A和集合B$的元素已经按照某一特定的但是任意的次序列出。此外，当$A=B$时我们对于$A和B$使用同样的排序。)关系 $R$可以用矩阵 ${\bf M}_r = [m_{ij}]$来表示，其中
$$
m_{ij}
\begin{cases}
1&如果 (a_i,b_j) \in R\\
\\
0&如果 (a_i,b_j) \notin R\\
\end{cases}
$$


#### 5.3.3 用图表示关系

** 定义一 **如果一个有向图由顶点(或结点)集 $V$和边(或弧)集 $E$组成，其中边集是 $V$中元素的有序对的集合。顶点 $a$叫做边 $(a,b)$的始点，而顶点 $b$叫做这条边的终点。
形如 $(a,a)$的边用一条从顶点 $a$到自身的弧表示。这种边叫做环(在关系的组合中保持本环所在顶点的路径)。


### 5.4 关系的闭包
#### 5.4.1 引言

一般说来，设 $R$是集合 $A$上的关系。 $R$可能具有或不具有某些性质 $P$，例如自反性、对称性或传递性。如果存在包含 $R$的具有性质 $P的关系S$。并且 $S是包含R$且具有性质 $P$的每一个关系的子集，那么 $S$叫做 $R$的关于 $P$的闭包。

#### 5.4.2 闭包

#### 5.4.3 有向图的路径
** 定义一 ** 在有向图 $G$中从 $a到b$的一条路径是 $G$中一条或多条边的序列 $(x_0, x_1),(x_1,x_2),(x_2,x_3,),\cdots,(x_{n-1},x_n)$，其中 $x_0 = a, x_n = b$。即一个边的序列，其中一条边的终点和路径中下一条边的起点相同。 这条路径标记为 $x_0,x_1,\cdots,x_{n-1},x_n$，长度为 $n$。在同一顶点开始和结束的路径也叫回路或圈。

** 定理一 ** 设 $R$是集合$A$上的关系。从 $a到b$存在一条长为 $n$($n$为正整数)的路径，当且仅当 $(a,b) \in R^n$。


#### 5.4.4 传递闭包
** 定义二 ** 设 $R$是集合 $A$上的关系。连通性关系 $R^*$由对 $(a,b)$构成，使得在 $R$中从顶点 $a到b$之间存在一条至少长为 $1$的路径。
因为 $R^n$由对 $(a,b)$构成，使得存在一条从 $a到b$的长为 $n$的路径，从而 $R^*$是所有集合 $R^n$的并。换句话说
$$
R^* = \bigcup_{n=1}^\infty R^n
$$

** 定理二 ** 关系 $R$的传递闭包等于连通性关系 $R^*$。

** 引理一 ** 设 $A是n$元素集合， $R是A$上的关系。如果 $R$中存在一条从 $a到b$的长至少为 $1$的路径，那么存在一条长度不超过$n$的路径(要么当前存在的这条$a到b$的路径长度不超过$n$,要么另外存在一条$a到b$的路径，其长度不超过$n$)。此外，当 $a\not= b$时，如果在 $R$中存在一条从$a到b$的路径，那么存在一条长度不超过$n-1$的这种路径。

** 定理三 ** 设 ${\bf M}_R$是 $n$元素集合上的关系 $R$的 $\mbox {0-1}$矩阵。那么传递闭包 $R^*$的 $\mbox{0-1}$矩阵是
$$
{{\bf M}_{R^*}} = {\bf M}_R \vee {\bf M}_R^{[2]} \vee {\bf M}_R^{[3]} \vee \cdots \vee {\bf m}_R^{[n]}
$$

$$
\begin{array}{||}
\hline
{\bf 算法1} 计算传递闭包的过程\\
{\bf procedure} \; transitive\; closure \;({\bf M}_R:n\times n 的\mbox {0-1}矩阵)\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\\
{\bf A}:={\bf M}_R\\
{\bf B}:={A}\\
{\bf for}\; i := 2 \;{\bf to}\; n\\
{\bf begin}\\
\qquad {\bf A}:={\bf A}\odot{\bf M}_R\\
\qquad B:={\bf B}\vee {\bf A}\\
end \lbrace {\bf B}是关于R^* 的\mbox{0-1}矩阵 \rbrace\\
\hline
\end{array}
$$

#### 5.4.5 活舍尔算法
** 引理二 ** 设 ${\bf W}_k = [w_{ij}^{[k]}]$是 ${\mbox{0-1}}$矩阵，它在 $(i,j)$位置有 $1$，当且仅当存在一条从 $v_i到v_j$的路径，其内点取自集合 $\lbrace v_1,v_2,\cdots,v_k\rbrace$，那么
$$
w_{ij}^{[k]} = w_{ij}^{[k-1]} \vee (w_{ik}^{[k-1]} \wedge w_{kj}^{k-1})
$$
其中 $i,j和k$是不超过 $n$的正整数。

$$
\begin{array}{||}
\hline
{\bf 算法2}\;沃舍尔算法\\
{\bf procedure}\;Warshall({\bf M}_R: n \times n的{\mbox{0-1}}矩阵)\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\\
{\bf W} := {\bf M}_R\\
{\bf for}\;k := 1 {\bf to}\;n\\
{\bf begin}\\
\qquad {\bf for}\; i:=1\; {\bf to}\;n\\
\qquad {\bf begin}\\
\qquad\qquad {\bf for}\; j:= 1 \; {\bf to}\; n\\
\qquad\qquad w_{ij}:=w_{ij}\vee (w_{ik} \wedge w_{kj})\\
\qquad {\bf end}\\
{\bf end}\lbrace \;{\bf W}= [w_{ij}]是{\bf M}_{R^*}\;\rbrace\\
\hline
\end{array}
$$

### 5.5 等价关系基础
#### 5.5.1 引言

#### 5.5.2 等价关系

** 定义一 ** 集合 $A$上的关系叫做等价关系，如果它是自反的、对称的和传递的。

** 定义二 ** 如果两个元素 $a和b$由于等价关系而相联系，则称它们是等价的。记法 $a \sim b$通常用来表示对于某个特定的等价关系来说， $a和b$是等价的元素。

#### 5.5.3 等价类
** 定义三 ** 设 $R是集合A$上的等价关系。与 $A$中的一个元素 $a$有关系的所有元素的集合叫做 $a$的等价类。 $A的关于R$的等价类记作 $[a]_R$。当只有一个关系被考虑时，我们将省去下标$R$并把这个等价类写作$[a]$。
换句话说，如果 $R$是集合 $A$上的等价关系，元素 $a$的等价类是
$$
[a]_R = \lbrace s \mid (a,s) \in R\rbrace
$$
如果 $b \in [a]_R，b$叫做这个等类的代表元。
#### 5.5.4 等价类与划分
** 定理一 ** 设 $R是集合A$上的等价关系。下面的命题是等价的。

$$
(\rm {i}) aRb \qquad (\rm {ii})[a] = [b] \qquad (\rm {iii})[a]\cap[b] \not=\emptyset
$$

** 定理二 ** 设 $R$是集合 $S$上的等价关系。那么 $R$的等价类构成 $S$的划分。相反， 给定集合的划分 $\lbrace A_i \mid i \in I\rbrace$，存在着等价关系$R$，它以集合 $A_i ,i \in I$作为它的等价类。

### 5.6 偏序
#### 5.6.1 引言
**  定义一 ** 集合 $S$上的关系 $R$，如果它是自反的、反对称的和传递的，就称为偏序。集合 $S和偏序R$一起叫做偏序集，记作 $(S,R)$。

** 定义二 ** 偏序集 $(S,\preccurlyeq)$的元素 $a和b$叫做可比的，如果 $a \preccurlyeq b\;或\; b \preccurlyeq a$。当 $a\;和\;b$是 $S$的元素并且既没有 $a \preccurlyeq b$，也没有 $b \preccurlyeq a$，则称 $a\;和\;b$是不可比的。

** 定义三 **如果 $(S,\preccurlyeq )$是偏序集，且 $S$的每对元素都是可比的，则 $S$叫做全序集或线序集，且 $\preccurlyeq$中做全序或线序。一个全序集也叫做链。

** 定义四 **对于偏序集 $(S,\preccurlyeq)$，如果 $\preccurlyeq$是全序，并且 $S$的每个非空子集都有一个最小元素，就称它为良序集。


** 定理一 ** $ \bf 良序归纳原理\quad $设 $S$是一个良序集，如果下述条件成立：
归纳步骤：对于一切 $y\in S$，如果 $P(x)$对于所有 $x  \in S且x \prec y$为真，则 $P(y)$为真。
那么 $P(x)$对所有的 $x \in S$为真。


#### 5.6.2 字典顺序
#### 5.6.3 哈塞图
#### 5.6.4 极大元素和极小元素
#### 5.6.5 格
如果一个偏序集的每对元素都有最小上界和最大下界，就称这个偏序集为格。
#### 5.6.6 拓朴排序
** 引理一 ** 每个有穷非空偏序集 $(S,\preccurlyeq)$都有极小元素。

$$
\begin{array}{||}
\hline
{\bf 算法1}\quad 拓朴排序 \\
\qquad \textbf {procedure} \quad topological\;sort(S:有穷偏序集)\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\\
\qquad k:=1\\
\qquad \textbf {while}\;S \not = \not O\\
\qquad \textbf {begin}\\
\qquad \qquad a_k:=S的极小元素\lbrace由引理1这样的元素一定存在\rbrace\\
\qquad \qquad S:=S-\lbrace a_k\rbrace\\
\qquad \qquad k:=k+1\\
\qquad \textbf{end}\\
\hline
\end{array}
$$

## 关键术语和结果
从 $A$到 $B$的二元关系 $A\times B$的子集。
$A$的关系：从 $A$到自身的二元关系（即$A\times A$的子集）。
$S \circ R:R与S$的合成。
$R^{-1}$: $R$的逆关系。
$R^n：R$的 $n$次幂。
自反的： $A$上的一个关系是自反的，如果对所有的 $a \in A$有 $(a,a)\in R$。
对称的： $A$上的一个关系是对称的，如果只要 $(a,b)\in R$就有 $(b,a)\in R$。
反对称的： $A$上的关系是反对称的，如果只要 $(a,b)\in R$和 $(b,a)\in R$就有 $a=b$。
传递的： $A$上的关系 $R$是传递的，如果从 $(a,b) \in R $和 $(b,c)\in R$推出 $(a,c)\in R$。
$A_1,A_2,\cdots.A_n的n$元关系： $A_1\times A_2\times \cdots \times A_n$的子集。
关系数据模型：一个使用 $n$元关系表示数据库的模型。
主关键字： $n$元关系中的一个域，使得一个 $n$元组被 它在这个域的值唯一确定。
复合关键字：一个 $n$元关系域的笛卡尔积，使得一个 $n$元组被它在这些域的值唯一确定。
选择算子：一个函数，它在 $n$元关系中选出满足特定条件的 $n$元组。
投影：一个函数，它从一个 $n$f元关系中通过删除域产生一个阶较小的关系。
连接：一个函数，它把具有某些相同的域的 $n$元关系组合起来。
有向图：称为基点的元素以及这些元素的有序对(也叫做边)的集合。
环：形如 $(a,a)$的边。
关系 $R$关于性质 $P$的闭包：包含 $R$的关系 $S$(如果 存在的话)具有性质 $P$，并且被任何包含 $R$且具有性质 $P$的关系所包含。
有向图中的路径：边的序列 $(a,x_1),(x_1,x_2),\cdots,(x_{n-2},x_{n-1}),(x_{n-1},b)$使得中每条边的终点是后面一条边的起点。
有向图的回路(或圈)：以同一项点作为起点和终点的路径。
$R^*$(连通性关系):由有序对$(a,b)$构成的关系，条件是存在一条从 $a到b$的路径。
等价关系：自反的、对称的和传递的关系。
等价：如果 $R$是等价关系，若 $aRb$，那么 $a$等价于 $b$。
$[\;a\;]_R(a关于R的等价类)$:$A$中所有等价于 $a$的元素的集合。
$[\;a\;]_m(模m同余类)$:与 $a模m$同余的整数 的集合。
集合$S$的划分：一族两两不相交的非空子庥，且这些子集的并就是 $S$。
偏序：自反的、反对称 的和传递的关系。
集序集$(S,R)$：集合 $S$与这个集合上的偏序 $R$。
可比的：偏序集 $(A,\preccurlyeq)$的元素 $a和b是可比的如果 a\preccurlyeq b 或b \preccurlyeq a$。
不可比的：一个偏序集的元素不是可比的。
全序（或线序）:一个偏序，并且它的每对元素都是可比的。
全序（或线序）集：具有全序（薄线序）的偏序集。
良序集：偏序 $(S,\preccurlyeq)$，其中 $\preccurlyeq$是全序， $S$的每个非空子集至少有一个元素。
字典顺序：笛卡尔积或串的一个偏序。
哈塞图：偏序集的图表示，其中所有的环和由传递性导出的边不出现，并且顶点的位置指示了边的方向。
极大元素：偏集序的一个元素，它不小于这个偏序集的所有其他元素。
极小元素：偏序集的一个元素，它不大于这个偏序集的所有其他元素。
最大元素：偏序集的一个元素，它大于或等于这个集合的所有其他元素。
最小元素：偏序集的一个元素，它小于或等于这个集合的所有其他元素。
集合的上界：偏序集的一个元素，它大于这个集合的所有其他元素。
集合的下界：偏序集的一个元素，它小于这个集合的所有其他元素。
集合的最小上界：集合的上界，它小于所有其他的上界。
集合的最大下界：集合的下界，它大于所有其他的下界。
格：一个偏序集，其中每对元素都有一个最大下界和一个最小上界。
与一个偏序相容的全序：包含了给定偏序的一个全序。
拓朴排序：用给定偏序构造一个相容的全序。